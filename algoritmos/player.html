<!DOCTYPE html>
<html>
	<head>
		<title>Aprende Vigenere Taller 2</title>
		<!-- force IE to latest engine--><meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- google site verification ( to prove onwership, DO NOT REMOVE )--><meta name="google-site-verification" content="uADWqtJQ2YqMmkuvqjGD6TjunQfayO9hSIYbdu_X-9g">
		<!-- Open Sans Font embedded--><!--link(href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css')--><!-- Ubuntu--><!--link(href='https://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css')--><!-- raleway--><link href="../https@fonts.googleapis.com/css@family=Raleway" rel="stylesheet" type="text/css">
		<!-- app CSS--><link rel="stylesheet" href="stylesheets/app.css">
		<!-- Algorithm client side class--><script src="javascripts/algorithm.js"></script>
		<!-- components available to all pages--><script src="javascripts/library/algomation/components/flashmessage.js"></script>
		<script src="javascripts/library/algomation/components/algotile.js"></script>
		<!-- common js libraries--><script src="../ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script src="../cdnjs.cloudflare.com/ajax/libs/amplifyjs/1.1.0/amplify.min.js"></script>
		<script src="../cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.3/moment.min.js"></script>
		<script src="../cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
		<script src="../cdnjs.cloudflare.com/ajax/libs/underscore.string/2.3.3/underscore.string.min.js"></script>
		<!-- common algomation code--><script src="javascripts/clientapp.js"></script>
		<script src="javascripts/util.js"></script>
		<script src="javascripts/localstorage.js"></script>
		<!-- constants shared with server--><script src="javascripts/consts.js"></script>
		<!-- bootstrap--><script>$.support.transition = false</script>
		<!--script(src='/bootstrap3/bootstrap-src/js/alert.js')--><script src="bootstrap3/bootstrap-src/js/button.js"></script>
		<!--script(src='/bootstrap3/bootstrap-src/js/carousel.js')--><!--script(src='/bootstrap3/bootstrap-src/js/collapse.js')--><script src="bootstrap3/bootstrap-src/js/dropdown.js"></script>
		<script src="bootstrap3/bootstrap-src/js/modal.js"></script>
		<!--script(src='/bootstrap3/bootstrap-src/js/scrollspy.js')--><!--script(src='/bootstrap3/bootstrap-src/js/tab.js')--><script src="bootstrap3/bootstrap-src/js/tooltip.js"></script>
		<!--script(src='/bootstrap3/bootstrap-src/js/popover.js')--><!--script(src='/bootstrap3/bootstrap-src/js/affix.js')--><link rel="stylesheet" href="bootstrap3/bootstrap-src/less/bootstrap.css">
		<!-- addthis.com--><script type="text/javascript" src="../s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4fd151d4369a39d5"></script></head>
		<!--ACE source code editor / viewer--><script src="javascripts/library/ace/ace-builds-master/src/ace.js"></script>
		<!-- Include correct version of API for algorithm we are going to play, the {#api} variable is supplied--><!-- by the page rendering code/route--><script src="javascripts/apis/1.0/core.js"></script>
		<script src="./javascripts/underscore.js"></script>
		<script src="./javascripts/underscore-string.js"></script>
		<script src="./javascripts/regenerator-runtime.js"></script>
		<script src="javascripts/apis/1.0/core.js"></script>
		<script src="javascripts/apis/1.0/color.js"></script>
		<script src="javascripts/apis/1.0/surface.js"></script>
		<script src="javascripts/apis/1.0/element.js"></script>
		<script src="javascripts/apis/1.0/layout.js"></script>
		<script src="javascripts/apis/1.0/dagre.js"></script>
		<script src="api/v1/source/5475f3335b77a60200e588be"></script>
		<script src="api/v1/source/54ea30f05c15440300d516f7"></script>
		<!--constants shared by all versions of the player--><script src="javascripts/library/algomation/components/const.js"></script>
		<!--user interface widgets shared by all versions of the player--><script src="javascripts/library/algomation/components/vcr.js"></script>
		<script src="javascripts/library/algomation/components/variables.js"></script>
		<script src="javascripts/library/algomation/components/messages.js"></script>
		<script src="javascripts/library/algomation/components/slider.js"></script>
		<!-- source code editor is shared--><script src="javascripts/library/algomation/components/jseditor.js"></script>
		<!-- version specific player application--><script src="javascripts/library/algomation/components/player.js"></script>
		<!-- jseditor has a style sheet--><link rel="stylesheet" href="stylesheets/jseditor.css">
		<!--version specific CSS for the player--><link rel="stylesheet" href="stylesheets/player.css">
		<!-- GA tracking code-->
<script>
/*    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','../www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53306103-2', 'auto');
    ga('send', 'pageview');
*/
</script>
<body>
<script>// global variables inserted by templating on server
var algo = algo || {};
algo.G = {
    username: "",
    userid: "",
    apis: "1.0",
    featuredid: "",
    testing: true,
    live: true
};
// controls whether ads are shown ( we don't want them on localhost )
google_adtest = "off";
</script>

<!-- standard master page header followed by app contant-->
<div style="min-height:8px">
	<label for="frase">Frase: </label><textarea id="frase" rows="4" cols="50"></textarea>
	<label for="clave">Clave: </label><input id="clave" type="text"/>
	<input type="button" onClick="encode()" value="EncodeIt"/>
	<input type="file" onchange='readText(this)' />
</div>
<!-- push everything else below the fixed header--><!--.navpadding-->
<script type="text/javascript" src="./FileSaver.js-master/FileSaver.js"></script>
<script type="text/javascript" src="./jsPDF/jspdf.js"></script>
<script type="text/javascript" src="./jsPDF/jspdf.plugin.addimage.js"></script>
<script type="text/javascript" src="./jsPDF/jspdf.plugin.standard_fonts_metrics.js"></script>
<script type="text/javascript" src="./jsPDF/jspdf.plugin.split_text_to_size.js"></script>	
<script type="text/javascript" src="./jsPDF/jspdf.plugin.from_html.js"></script>
<script type="text/javascript" src="./html2canvas.js"></script>
<script id="worker1" type="javascript/worker">
/*
 The MIT License (MIT)

 Copyright (c) 2014 Duncan Meech / Algomation

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */

/*global algo,_*/

var globalScope = this;

/**
 * handle and respond to messages from our owing page/application
 * @param event
 */
self.onmessage = function (event) {
    // handle named events

    switch (event.data.name) {

        // initialization message

        case "M_Initialize":
        {
            // create the singleton app for this worker and supply the worker object so it can send messages

            new WorkerApp(this, event.data.algorithmID, event.data.api, event.data.frase, event.data.clave,event.data.url);
        }
            break;

        // After the user acknowledges a pause we continue with the algorithm

        case "M_Continue":
        {
            WorkerApp.I.pauseOrContinue();
        }
            break;

    }
};


/**
 * the application class that runs in this worker
 * @constructor
 */
var WorkerApp = function (worker, algorithmID, api, frase, clave,url) {
	
	// save the worker object so we can post messages using it
    this.worker = worker;

    // make ourselves the singleton instance

    WorkerApp.I = this;

    /* when the algorithm is being edited the full source code is used for all files, including underscore and the regenerator
     modules. When the player is running stand alone ( or embedded ) the uglified / compressed source is used.
     If we are part of the minified library that global/namespace algo will exist, otherwise it won't.
     */

	if (!globalScope['algo']) {

        // NOTE: This block must be kept in synch with the grunt task: uglify::workerjs to ensure the correct files
        // are imported or compressed in the a single file
		
        importScripts(
            url+'/javascripts/underscore.js',
            url+'/javascripts/underscore-string.js',
            url+'/javascripts/regenerator-runtime.js',
            url+'/javascripts/apis/' + api + '/core.js',
            url+'/javascripts/apis/' + api + '/layout.js',
            url+'/javascripts/apis/' + api + '/color.js',
            url+'/javascripts/apis/' + api + '/element.js',
            url+'/javascripts/apis/' + api + '/surface.js',
            url+'/javascripts/apis/' + api + '/dagre.js'

        );

    }
	
    // add underscore string mixin
    _.mixin(_.str.exports());

    // create our surface and tell it that it is running in a worker not the DOM

    this.surface = new algo.render.Surface({

        // TODO, this size must match algo.Player.kSW, kSH in player.js, find a good way to do that
        location: algo.render.Surface.WORKER,
        bounds  : new algo.layout.Box(0, 0, 900, 556)

    });

    // load the actual file containing the algorithm.

    importScripts(url+"/api/v1/source/"+algorithmID);

    // create the users algorithm as a generator and start running it

    try {
	    this.userAlgorithm = algorithm(frase,clave);

    } catch (error) {

        this.postError(error);
        return;
    }

    // send acknowledgement that we are initialized

    this.worker.postMessage({
        "name": "M_Initialize_ACK"
    });

    // call continue to start the algorithm

    this.continue();

};

/**
 * continue with the algorithm
 */
WorkerApp.prototype.continue = function () {

    // run until we hit the first yield


    var y;

    try {

        y = this.userAlgorithm.next();

    } catch (error) {

        this.postError(error);

    }

    // send results of yield to the DOM side or signal the algorithm is complete

    if (y.done) {
        this.done();
    } else {
        this.pause(y.value);
    }
};

/**
 * post the exception to the main thread. The worker is usually terminated on exceptions so we don't need to do anything
 * else.
 * @param error
 */
WorkerApp.prototype.postError = function(error) {

    this.worker.postMessage({

        name          : 'M_Exception',
        message       : error.message,
        stack         : error.stack
    });

};

/**
 * called whenever the algorithm yields
 * @param options
 */
WorkerApp.prototype.pause = function (pauseParameters) {

    // save the current commands, update commands with arrays instead of values are sent one a time

    this.currentCommands = this.surface.flushCommands();

    // process options, which converts arrays of values to single values and marks then options objects
    // as containing more commands

    var activeCommands = [];

    _.each(this.currentCommands, function (command) {

        // only update commands can contain arrays

        if (command.name === "updateElement") {

            activeCommands.push({
                name   : command.name,
                options: this.surface.processOptions(command.options)
            });

        } else {

            // all other commands just get copied in ( currently only the delete command )
            activeCommands.push(command);
        }

    }, this);

    // send a pause event to the DOM and supply all current commands and options

    this.worker.postMessage({

        name          : 'M_Pause',
        renderCommands: activeCommands,
        options       : pauseParameters
    });

};

/**
 * if we are done with the last set of render commands then call continue otherwise send the next batch
 * @param options
 */
WorkerApp.prototype.pauseOrContinue = function () {

    // scan all commands and send those with remaining options

    var activeCommands = [];

    _.each(this.currentCommands, function (command) {

        if (command.name === "updateElement" && command.options.more) {

            activeCommands.push({
                name   : command.name,
                options: this.surface.processOptions(command.options)
            });
        }

    }, this);

    // if there are still active commands then send them otherwise continue

    if (activeCommands.length) {

        this.worker.postMessage({

            name          : 'M_Pause',
            renderCommands: activeCommands,
            options       : {autoskip: true}     // force an autoskip when chaining updates

        });
    } else {

        // no remaining commands so continue

        this.continue();
    }

};

/**
 * called whenever the algorithm is completed
 * @param options
 */
WorkerApp.prototype.done = function () {

    // signal the algorithm is complete and flush any remaining graphics commands

    this.worker.postMessage({

        name          : 'M_Done',
        renderCommands: this.surface.flushCommands()
    });

};
</script>

<script>
	divPDF = $('<div id="divpdf"></div>');
	imagenes = new Array();
	var reader = new FileReader();

	function readText(that){

		if(that.files && that.files[0]){
			var reader = new FileReader();
			reader.onload = function (e) {  
				var output=e.target.result;
			
				//process text to show only lines with "@":				
				//output=output.split("\n").filter(/./.test, /\@/).join("\n");

				document.getElementById('frase').innerHTML= output;
			};//end onload()
			reader.readAsText(that.files[0]);
		}//end if html5 filelist support
	} 
	function encode() {
		frase=$('#frase').val();
		clave=$('#clave').val();
		
		new algo.App();
		var player_dom = $('[data-element="player-dom"]');
		new algo.Player(player_dom);
	};
	function guardarResultado(){
			var resultado = $('#resultado').text();
			var blob = new Blob([resultado], {
    				type: "text/plain;charset=utf-8;",
			});
			saveAs(blob, "resultado.txt");
	};
	function guardarSecuencia(){
		var doc = new jsPDF();
		// All units are in the set measurement for the document
		// This can be changed to "pt" (points), "mm" (Default), "cm", "in"	


			// We'll make our own renderer to skip this editor
			var specialElementHandlers = {
				'#editor': function(element, renderer){
					return true;
				}
			};
			
			html2canvas($(".algo-surface"), {
				onrendered: function(canvas) {
		
					var imagen = $('<img style="-webkit-user-select: none;" src="'+canvas.toDataURL("image/png")+'" width="1366" height="600">');
					imagenes.push(canvas.toDataURL("image/jpeg"));
					divPDF.append(imagen);
					$('body').append(divPDF);
					doc.setFontSize(40);
					doc.text(35, 25, "Secuencia");
					for( var i = 0; i< imagenes.length ; i++ ){
						if ( i != 0 ){
							doc.addPage();
						}
						doc.addImage(imagenes[i], 'JPEG', 15, 40, 180, 160);
					}
					
					doc.output("dataurlnewwindow");
					imagenes = new Array();
				}
			});
	};
</script>

<!--primary content DOM for the player-->
<div data-element="player-dom" class="container-fluid">
	<div class="row">
		<div class="col-md-5">
			<div data-element="messages" class="algo-message pane"></div>
		</div>
		<div class="col-md-7">
			<div data-element="vcr" class="algo-vcr pane">
				<div class="algo-vcr-buttons">
					<button data-element="nextBtn" data-toggle="tooltip" data-placement="top" data-container="body" class="btn btn-primary btn-sm">Continuar</button>
					<div data-element="playGroup" class="btn-group">
						<button data-element="singleStepBtn" data-toggle="tooltip" data-placement="top" data-container="body" class="btn btn-sm">Single Step</button>
						<button data-element="continuousBtn" data-toggle="tooltip" data-placement="top" data-container="body" class="btn btn-sm">Continuous</button>
					</div>
					<div data-element="speedGroup" class="btn-group">
						<button data-element="slowBtn" data-speed="1000" data-toggle="tooltip" data-placement="top" data-container="body" class="btn btn-sm">Slow</button>
						<button data-element="normalBtn" data-speed="500" data-toggle="tooltip" data-placement="top" data-container="body"  class="btn btn-sm">Normal</button>
						<button data-element="fastBtn" data-speed="200" data-toggle="tooltip" data-placement="top" data-container="body" class="btn btn-sm">Fast</button>
					</div>
					<div data-element="saveGroup" class="btn-group">
						<button data-element="saveToPDFBtn" data-toggle="tooltip" data-placement="top" data-container="body" class="btn btn-primary btn-sm disabled" onclick="guardarSecuencia()">Guardar secuencia</button>
						<button data-element="saveToTXTBtn" data-toggle="tooltip" data-placement="top" data-container="body" class="btn btn-primary btn-sm disabled" onclick="guardarResultado()">Guardar resultado</button>
					</div>
				</div>
				<div data-element="sliderContainer" class="algo-slider"></div>
			</div>
			<div class="surface-window pane">
				<div data-element="surface" class="algo-surface"></div>
			</div>
		</div>
	</div>
	<!-- include the shared player templates--><!-- this style block will have the transition speed dynamically injected into it-->
	<style id="transitionSpeed"></style>
	<!-- templates used by the player, these are shared between several pages e.g. editor / player etc-->
	<div class="hidden"><div data-template="message-template" class="message-inner dl-horizontal"><div data-element="titleBlock"><dt>Algorithm</dt><dd data-element="title"></dd><hr></div><div data-element="descriptionBlock"><dt>Description</dt><dd data-element="description" class="pre-line"></dd><hr></div><div data-element="authorBlock"><dt>Created By</dt><dd data-element="author"></dd><hr></div><div data-element="stepBlock" class="hidden"><dt>Step</dt><dd data-element="step" class="pre-line"></dd><hr></div><div data-element="variablesBlock" class="hidden"><dt>Variables</dt><dd data-element="variables"></dd></div></div><div data-template="loading-template" class="loading-horizontal"><div class="loading-ball"></div><div class="loading-ball"></div><div class="loading-ball"></div><div class="loading-ball"></div><div class="loading-ball"></div></div></div></div><!-- page footer section--><!--div(style="margin:1em auto 1em auto;text-align:center")--><!--    include adsense/728x90xblue.html--><!-- generic message dialog, bootstrap 3.0--><div data-dialog="message-dialog" class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h3 data-element="message-header" class="modal-title"></h3></div><div class="modal-body"><p data-element="message-message"></p></div><div class="modal-footer"><button data-element="close-button" type="button" autofocus class="btn btn-primary">Close</button></div></div></div></div><!-- generic ok/cancel dialog, bootstrap 3.0--><div data-dialog="okcancel-dialog" class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h3 data-element="message-header" class="modal-title"></h3></div><div class="modal-body"><p data-element="message-message"></p></div><div class="modal-footer"><button data-element="cancel-button" type="button" class="btn btn-default">Cancel</button><button data-element="ok-button" type="button" autofocus class="btn btn-primary">Ok</button></div></div></div></div><!-- embedded algorithm script generator dialog--><div data-dialog="embed-dialog" class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Algorithm Embed Code</h3></div><div class="modal-body"><form data-element="widthForm" class="form-inline form-group embed-size"><label>Width &nbsp;<input data-element="widthInput" class="form-control"></label><label>Height &nbsp;<input data-element="heightInput" readonly class="form-control"></label><p class="help-block hidden">Width must be a number between 450 and 900</p></form><textarea data-element="script" rows="5" readonly autofocus class="form-control embed-code"></textarea></div><div class="modal-footer"><button data-element="close-button" type="button" class="btn btn-primary">Close</button></div></div></div></div><!-- share dialog--><div data-dialog="share-dialog" class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Share this algorithm</h3></div><div class="modal-body"><p>The following link can be used to show the algorithm running in the player.</p><input data-element="shareLink" autofocus readonly class="form-control shareLink"><br><p>Or use these social buttons to share this algorithm</p><div class="addthis_sharing_toolbox"></div></div><div class="modal-footer"><button data-element="close-button" type="button" class="btn btn-primary">Close</button></div></div></div></div><!-- templates block--><div class="hidden"><!-- template for flash message class--><div data-template="flash-message" class="flashmessage"><div data-element="title" class="flashmessage-header"></div><div data-element="message" class="flashmessage-message"></div><div data-element="progress" class="flashmessage-progress progress progress-striped active hidden"><div style="width: 100%" class="progress-bar progress-bar-primary"></div></div></div><!-- template for algo.components.AlgorithmTile--><div data-template="algorithm-tile" class="algorithm-tile"><a data-element="title" data-toggle="tooltip" data-placement="top" title="Click to visualize this algorithm." class="algorithm-tile-title"></a><a data-element="featuredSlug" class="algorithm-tile-slug hidden"></a><div class="algorithm-tile-author text-muted">Author:<a data-element="author" data-toggle="tooltip" data-placement="top" title="See other algorithms by this author" class="algorithm-tile-author-link"></a></div><div data-element="created" class="algorithm-tile-created"></div><div data-element="modified" class="algorithm-tile-modified"></div><div data-element="description" class="algorithm-tile-description"></div><a data-element="playerLink" data-toggle="tooltip" data-placement="bottom" title="Click to visualize this algorithm" class="algorithm-tile-player-link">Open in player</a><a data-element="editLink" data-toggle="tooltip" data-placement="bottom" title="Click to edit this algorithm" class="algorithm-tile-edit-link hidden">Edit this algorithm</a><a data-element="deleteLink" data-toggle="tooltip" data-placement="bottom" title="Delete Algorithm" class="algorithm-tile-delete-link hidden">Delete Algorithm</a><a data-element="forkLink" data-toggle="tooltip" data-placement="bottom" title="Fork this algorithm and start editing" class="algorithm-tile-fork-link hidden">Fork this algorithm</a><hr></div></div></body></html>